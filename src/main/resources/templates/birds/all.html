<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head th:include="layout :: site-head">
    <title>Users</title>
</head>
<body>
<header th:include="layout :: site-header" ></header>
<div class="container-fluid" id="app">
	<div class="modal fade" tabindex="-1" role="dialog" id="deleteModal" aria-labelledby="deleteModal" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Delete bird</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>Id: {{selectedBird.id}}</p>
					<p>Name : {{selectedBird.name}}</p>
					<p>Description:<br/> {{selectedBird.description}}</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-error" v-on:click="deleteSubmit" data-dismiss="modal">Delete</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
   <table class="table table-hover table-responsive-sm">
   		<caption>List of birds</caption>
        <thead>
        <tr>
            <td></td>
            <td><input type="text" v-model="nameFilter"/></td>
            <td></td>
        </tr>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">Heigth</th>
            <th scope="col">...</th>
        </tr>
        </thead>
        <tbody>

        <tr v-for="bird in birds">
            <td>{{bird.id}}</td>
            <td>{{bird.name}}</td>
            <td>{{bird.averageHeigth}}</td>
            <td>
            	<a class="btn btn-primary" :href="'birds/'+bird.id">view</a>
            	<button class="btn" v-on:click="deleteBird(bird)">delete</button>
			</td>
        </tr>
        </tbody>
    </table>
</div>
<footer th:replace="layout :: site-footer" ></footer>
<script th:replace="layout :: vueJS"></script>
<div th:replace="layout :: bottom-script"></div>
<script th:inline="javascript">
    /*<![CDATA[*/
    var birds = /*[[${birds}]]*/[];
    /*]]>*/
    new Vue({
        el: '#app',
        data: {
            birds: birds,
            selectedBird: birds[0],
            nameFilter: ""
        },
        methods:{
			filter: function(bird){
			    return bird.name.includes(nameFilter);
			},
			deleteBird: function(bird){
				this.selectedBird = bird;
				$("#deleteModal").modal('show');
			},
			deleteSubmit: function(){
			    var self = this;
				$.ajax({
					type: "GET",
					url: "/birds/delete/"+ this.selectedBird.id,
				 	success: function(data)
					{
						if(data.status === 1){
							var index = self.birds.indexOf(self.selectedBird);
							if (index > -1) {
								self.birds.splice(index, 1);
							}
						}else{
							console.log(data);
						    alert(data.messageError);
						}
                        $("#deleteModal").modal('hide');
				 	}
			   	});
			}
        }
    })
</script>
</body>
</html>