<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: site-head">
    <title>View Post</title>
</head>

<body>

<header th:replace="layout :: site-header" ></header>
<main class="container-fluid" id="app">
	<h1>{{bird.name}}</h1>
	<p>{{bird.description}}</p>
	<ul>
		<li v-for="attribute in attributes" v-if="this.bird.attributes[attribute.key] !== undefined">
			<p>{{attribute.key}} :
				<select class="multiple-select" multiple="multiple" v-model="bird.attributes[attribute.key]">
					<option v-for="value in attribute.values" :value="value">{{value}}</option>
				</select>
			</p>
		</li>
		<li>
			<select id="newAttributeSelect">
				<option v-for="attribute in attributes" v-if="bird.attributes[attribute.key] === undefined">{{attribute.key}}</option>
			</select>
			<button class="btn btn-primary" v-on:click="addNewAttribute()">add attribute</button>
		</li>
	</ul>
	<!--TODO BIRD PICTURE-->
</main>
<footer th:replace="layout :: site-footer" ></footer>
<script th:replace="layout :: vueJS"></script>
<div th:replace="layout :: bottom-script"></div>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<script th:inline="javascript">
	/*<![CDATA[*/
    var bird = /*[[${bird}]]*/[];
    var attributes = /*[[${attributes}]]*/[];
    new Vue({
		el: '#app',
		data: {
			bird: bird,
			attributes: attributes,
			newName: bird.name,
			newDescription: bird.description,
		},
		methods:{
		    editBird: function(){

		    },
		    enditSubmit: function(){

		    },
		    addNewAttribute: function(){
		        var newAttriuteKey = $("#newAttributeSelect option:selected").text();
		        this.$set(this.bird.attributes, newAttriuteKey, []);
		    },
		    consoleLog: function(data){
		        console.log(data)
		    },
		    selectedAttribute: function(key, value){
				return this.bird.attributes[key] !== undefined && this.bird.attributes[key].includes(value);
		    },
		    addSelect2: function(){
				$(document).ready(function() {
					$('.multiple-select').select2({
						width: '100%',
						dropdownAutoWidth: true,
					});
				});
		    }
		},
		mounted: function(){
			this.addSelect2();
		},
		updated: function(){
			this.addSelect2();
		}
	});
    /*]]>*/
</script>
</body>
</html>