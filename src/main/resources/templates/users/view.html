<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout::site-head">
    <title>NatAdmin - User</title>
</head>
<body>
<header th:replace="layout::site-header" ></header>
<div class="container-fluid" id="app">
<div class="modal fade" tabindex="-1" role="dialog" id="editModal" aria-labelledby="editModal" aria-hidden="true">
  	<div class="modal-dialog" role="document">
    	<div class="modal-content">
			<form id="editForm">
				<div class="modal-header">
					<h5 class="modal-title">Edit account</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label for="fullName">Full Name</label>
						<input type="text" class="form-control" name="fullName" placeholder="Full Name" v-model="fullName"/>
					</div>
					<div class="form-group">
						<label for="email">Email</label>
						<input type="email" class="form-control" name="email" placeholder="sample@domain.com" v-model="	email"/>
					</div>
					<div class="form-group">
						<label for="admin">Admin</label>
						<input type="checkbox" class="form-check-input" name="admin" v-model="admin"/>
					</div>
					<div class="form-group">
						<label for="password">New password</label>
						<input type="password" class="form-control" name="password" v-model="password"/>
					</div>
					<div class="form-group">
						<label for="confirmedPassword">Confirm new Password</label>
						<input type="password" class="form-control" name="confirmedPassword" v-model="passwordConfirmed"/>
					</div>
					<div v-if="password !== passwordConfirmed" class="alert alert-danger" role="alert">
                      	Passwords doesnt match!
                    </div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" v-on:click="editSubmit">Edit</button>
					<button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>
				</div>
			</form>
		</div>
	</div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="deleteModal" aria-labelledby="deleteModal" aria-hidden="true">
  	<div class="modal-dialog" role="document">
    	<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Delete account</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<p>Full Name : {{RUser.fullName}}</p>
				<p>Email: {{RUser.email}}</p>
				<p>Admin: {{RUser.admin}}</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" v-on:click="deleteSubmit">Delete</button>
				<button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>
			</div>
		</div>
	</div>
</div>
	<img :src="RUser.profilePictureUrl"/>
	<h2>{{RUser.fullName}}</h2>
	<h2>{{RUser.email}}</h2>
	<button type="button" class="btn btn-primary" v-on:click="editUser">Edit</button>
	<button type="button" class="btn btn-warning" v-on:click="deleteUser">Delete</button>
	<table class="table table-hover table-responsive-sm">
		<caption>Sessions</caption>
		<thead>
			<tr>
				<th>Location</th>
				<th></th>
				<th>...</th>
			</tr>
		</thead>
		<tbody>
			<tr v-for="session in RUser.sessions">
				<td>{{session.location}}</td>
				<td>{{session.informations}}</td>
				<td><a :href="'/sessions/' + RUser.session.id">view</a></td>
			</tr>
		</tbody>
	</table>
</div>
<footer th:replace="layout :: site-footer" ></footer>
<script th:replace="layout :: vueJS"></script>
<div th:replace="layout :: bottom-script"></div>
<script th:inline="javascript" type="application/javascript">
/*<![CDATA[*/
var RUser = /*[[${RUser}]]*/;
new Vue({
	el: '#app',
	data: {
		user: user,
		pictureUrl: user.pictureUrl,
		fullName: user.fullName,
		email: user.email,
		admin: user.admin,
		password: "",
		passwordConfirmed: ""
	},
	methods: {
		editUser: function(){
			$("#editModal").modal('show')
		},
		editSubmit: function(){
		    var self = this;
		    $.ajax({
				type: "POST",
				url: "/users/edit/"+ this.user.id,
				data: $("#editForm").serialize(),
				success: function(data){
					if(data.status === 1){
						self.user.fullName = self.fullName;
						self.user.email = self.email;
						self.user.admin = self.admin;
					}else{
						console.log(data);
						alert(data.errorMessage);
					}
					$("#editModal").modal('hide')
				}
			});
		},
		deleteUser: function(){
$			("#deleteModal").modal('show')
		},
		deleteSubmit: function(){
			 var self = this;
			  $.ajax({
				 type: "GET",
				 url: "/users/delete/"+ self.user.id,
				 success: function(data)
					 {
						 if(data.status === 1){
						     window.location = "/users/";
						 }else{
							 console.log(data);
							 alert(data.errorMessage);
						 }
						 $("#deleteModal").modal('hide')
					 }
			   });
		}
	}
});
/*]]>*/
</script>
</body>
</html>